<style>
    .code-block-wrapper {
        position: relative;
    }
    .copy-code-button {
        position: absolute;
        top: 8px;
        right: 8px;
        padding: 4px 8px;
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        opacity: 0;
        transition: opacity 0.3s, background 0.3s;
        z-index: 10;
    }
    .code-block-wrapper:hover .copy-code-button {
        opacity: 1;
    }
    .copy-code-button:hover {
        background: rgba(255, 255, 255, 0.2);
    }
    .copy-code-button.copied {
        background: rgba(46, 160, 67, 0.8);
        border-color: rgba(46, 160, 67, 1);
    }
</style>
<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
        // 为所有代码块添加复制按钮
        document.querySelectorAll('pre code').forEach(function(codeBlock) {
            var pre = codeBlock.parentNode;
            
            // 避免重复添加
            if (pre.parentNode.classList.contains('code-block-wrapper')) {
                return;
            }
            
            // 创建包装器
            var wrapper = document.createElement('div');
            wrapper.className = 'code-block-wrapper';
            pre.parentNode.insertBefore(wrapper, pre);
            wrapper.appendChild(pre);
            
            // 创建复制按钮
            var button = document.createElement('button');
            button.className = 'copy-code-button';
            button.textContent = '复制';
            button.setAttribute('aria-label', '复制代码');
            
            // 添加点击事件
            button.addEventListener('click', function() {
                var code = codeBlock.textContent;
                navigator.clipboard.writeText(code).then(function() {
                    button.textContent = '已复制!';
                    button.classList.add('copied');
                    setTimeout(function() {
                        button.textContent = '复制';
                        button.classList.remove('copied');
                    }, 2000);
                }).catch(function(err) {
                    console.error('复制失败:', err);
                    button.textContent = '复制失败';
                    setTimeout(function() {
                        button.textContent = '复制';
                    }, 2000);
                });
            });
            
            wrapper.appendChild(button);
        });
    });
</script>
